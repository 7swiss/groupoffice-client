<go-loadmask ng-if="onSettingsPage" active="contact.showMask"></go-loadmask>

<form class="ab-contact-form form-horizontal go-labels" name="contactForm" im-submit="save()" novalidate>
	<div class="go-toolbar">
	
		<a ng-if="!onSettingsPage" class="btn" ng-click="cancel();">
			<span class="fa fa-chevron-left"></span>
		</a>
		
		<a ng-if="onSettingsPage" class="btn visible-xs" ui-sref="settings">				
			<span class="fa fa-chevron-left"></span>
		</a>

		<button type="submit" class="btn-primary">
			<i class="fa fa-floppy-o"></i> {{'Save'| t}}
		</button>
	
	</div>

	<div class="go-scrollable-panel">

<!--		<div class="row">
			<div class="col-lg-6">-->
				<div class="go-card">
					
					<h1>{{"Properties" | t}}</h1>

						
						<div class="form-group">

							<label ng-if="!contact.attributes.isCompany" for="contactName">{{"Name"| t}}</label>
							<label ng-if="contact.attributes.isCompany" for="companyName">{{"Name"| t}}</label>

							<div class="input-group ab-name-group" ng-if='!contact.attributes.isCompany'>

								<input type="text" id="name" name="contactName" ng-model="contact.attributes.name" ng-change="changeFullName()" required autofocus />
								<div class="input-group-btn">
									<button type="button" ng-click="toggleName()" class="btn btn-default"><i class="fa" ng-class="{'fa-chevron-down': !showNameParts, 'fa-chevron-up': showNameParts}"></i></button>					
								</div>
							</div>

							
							<div class="ab-name-group" ng-if="contact.attributes.isCompany">
								<input type="text" id="name" name="companyName" ng-model="contact.attributes.name" required autofocus />
							</div>

							<im-image-upload-placeholder class="ab-contact-photo"
								im-image-attribute="contact.attributes.photoFilePath"
								im-image-temp-attribute="contact.attributes.photoTempPath"
								im-delete-permission="contact.permissions.editAccess" 
								im-thumb-route="contacts/{{contact.attributes.id}}/thumb"
								im-thumb-width="75"
								im-thumb-height="100"
							></im-image-upload-placeholder>


							<im-show-error ng-if="!contact.attributes.isCompany" for="contactName" im-model="contact"></im-show-error>
							<im-show-error ng-if="contact.attributes.isCompany" for="companyName" im-model="contact"></im-show-error>
						</div>
						

						<div ng-if="showNameParts">
							<div class="form-group">
								<label for="firstName">{{"First name"| t}}</label>
							
								<input type="text" id="firstName" ng-model="contact.attributes.firstName" required />
							
							</div>

							<div class="form-group">							
								<label for="middleName">{{"Middle name"| t}}</label>								
								<input type="text" id="middleName" ng-model="contact.attributes.middleName" />								
							</div>

							<div class="form-group">							
								<label for="lastName">{{"Last name"| t}}</label>
								<input type="text" id="lastName" ng-model="contact.attributes.lastName" />
							</div>
						</div>


						<div class="form-group" ng-if="!contact.attributes.isCompany">
							<label>{{"Gender"| t}}</label>

							<div class="input-group">		
								<label class="radio-inline">
									<input type="radio" ng-model="contact.attributes.gender" ng-value="null"> {{"Unknown"| t}}
								</label>
								<label class="radio-inline">
									<input type="radio" ng-model="contact.attributes.gender" value="M"> {{"Male"| t}}
								</label>
								<label class="radio-inline">
									<input type="radio" ng-model="contact.attributes.gender" value="F"> {{"Female"| t}}
								</label>
							</div>
						</div>


						<div class="form-group">
							<label>{{"Special dates"| t}}</label>			

						
							<div ng-if="!specialDate.attributes.markDeleted" class="im-input-group-multiple input-group" ng-repeat="specialDate in contact.attributes.dates">

								<div class="input-group-btn">
									
									<select 
										class="form-control" 
										style="width:120px" 
										ng-model="specialDate.attributes.type" 
										ng-options="number.value as number.label for number in dateOptions">											
									</select>
									
<!--									<ui-select ng-model="specialDate.attributes.type">
										<ui-select-match class="ab-multi-input-select" placeholder="Please select...">{{$select.selected.label}}</ui-select-match>
										<ui-select-choices repeat="item.value as item in dateOptions | filter: $select.search">
											<div ng-bind-html="item.label | highlight: $select.search"></div>
										</ui-select-choices>
									</ui-select>-->
								</div>	
								
								
								
								<input type="text" name="date_{{$index}}" ng-model="specialDate.attributes.date" datepicker-options="datePickerOptions" datepicker-popup="dd-MM-yyyy" is-open="specialDate.isOpen" ng-click="specialDate.isOpen = true" close-text="{{'Close' | t}}" />
								<im-show-error for="date_{{$index}}" attribute-name="date" im-model="specialDate"></im-show-error>
								<div class="input-group-btn">
									<!--<button type="button" class="btn btn-default" ng-click="openDate(specialDate, $event)"><i class="fa fa-calendar"></i></button>-->

									<button type="button" class="btn btn-danger" ng-click="specialDate.attributes.markDeleted = true;"><i class="fa fa-trash-o"></i></button>
								</div>			
							</div>

							<span class="btn btn-default" ng-click="addDate()"><i class="fa fa-plus"></i> {{"Add special date"| t}}</span>
						
						</div>



						<div class="form-group">
							<label>{{"E-mail"| t}}</label>
					
							<div ng-if="!emailAddress.attributes.markDeleted" ng-repeat="emailAddress in contact.attributes.emailAddresses">

								<div class="im-input-group-multiple input-group">
								<div class="input-group-btn">
									<select 
										class="form-control" 
										style="width:120px" 
										ng-model="emailAddress.attributes.type" 
										ng-options="number.value as number.label for number in emailAddressOptions">											
									</select>
									<!--
																		<button type="button" class="btn btn-default ab-multi-input-select" ng-model="emailAddress.attributes.type" data-html="1" ng-options="type.value as type.label for type in emailAddressOptions" bs-select>
																			Type <span class="caret"></span>
																		</button>-->

<!--									<ui-select ng-model="emailAddress.attributes.type">
										<ui-select-match class="ab-multi-input-select" placeholder="Please select...">{{$select.selected.label}}</ui-select-match>
										<ui-select-choices repeat="item.value as item in emailAddressOptions | filter: $select.search">
											<div ng-bind-html="item.label | highlight: $select.search"></div>
										</ui-select-choices>
									</ui-select>-->

								</div>
									<input type="email" name="email_{{$index}}" ng-model="emailAddress.attributes.email" autofocus="$index > 0 && !emailAddress.attributes.id">
								<span class="input-group-btn">
									<button type="button" class="btn btn-danger" ng-click="emailAddress.attributes.markDeleted = true;"><i class="fa fa-trash-o"></i></button>
								</span>


								</div>
								<im-show-error for="email_{{$index}}" attribute-name="email" im-model="emailAddress"></im-show-error>
							</div>

							<span class="btn btn-default" ng-click="addEmailAddress()"><i class="fa fa-plus"></i> {{"Add e-mail address"| t}}</span>
					
						</div>



						<div class="form-group">
							<label>{{"Phone"| t}}</label>
				
							<div ng-if="!phoneNumber.attributes.markDeleted" class="im-input-group-multiple input-group" ng-repeat="phoneNumber in contact.attributes.phoneNumbers">

								<div class="input-group-btn">			
									<select class="form-control" style="width:120px" ng-model="phoneNumber.attributes.type" ng-options="number.value as number.label for number in phoneNumberOptions"></select>

								

<!--									<ui-select ng-model="phoneNumber.attributes.type">
										<ui-select-match class="ab-multi-input-select" placeholder="Please select..."><span ng-bind-html="$select.selected.label"></span></ui-select-match>
										<ui-select-choices repeat="item.value as item in phoneNumberOptions | filter: $select.search">
											<div ng-bind-html="item.label | highlight: $select.search"></div>
										</ui-select-choices>
									</ui-select>-->
								</div>
								<input type="text" name="number_{{$index}}" ng-model="phoneNumber.attributes.number" autofocus="$index > 0 && !phoneNumber.attributes.id">
								<im-show-error for="number_{{$index}}" attribute-name="number" im-model="phoneNumber"></im-show-error>
								<span class="input-group-btn">
									<button type="button" class="btn btn-danger" ng-click="phoneNumber.attributes.markDeleted = true;"><i class="fa fa-trash-o"></i></button>
								</span>				
							</div>

							<span class="btn btn-default" ng-click="addPhoneNumber()"><i class="fa fa-plus"></i> {{"Add phone number"| t}}</span>
						
						</div>

						<div class="form-group">
							<label>{{"Tags"| t}}</label>	

				
							<im-multi-select-field 
								auto-create="true"
								store-route="tags" 
								model-attribute="contact.attributes.tags" 
								model-attribute-display-name="name" 
								input-placeholder="{{'Add tags...'| t}}">				
							</im-multi-select-field>
							

						</div>
						

						<script type="text/ng-template" id="customTemplate.html">
							<a>
							  <span ng-if="!match.model.attributes.id">{{"Create new company" | t}}: </span>
								<span bind-html-unsafe="match.label | typeaheadHighlight:query"></span>
							</a>
						</script>
						
						<div class="form-group" ng-if="!contact.attributes.isCompany">
							<label>{{"Company"| t}}</label>	

							<input type="text" typeahead-template-url="customTemplate.html" ng-model="contact.attributes.company" typeahead="company as company.attributes.name for company in getCompanies($viewValue)">


						</div>
						    
						<div class="form-group">
							<label>{{"Addresses"| t}}</label>

							
								<div class="row">
								<div ng-if="!address.attributes.markDeleted" class="col-md-6" ng-repeat="address in contact.attributes.addresses">

									<div class="form-group no-label">
										<div class="input-group">
							<select class="form-control" ng-model="address.attributes.type" ng-options="number.value as number.label for number in emailAddressOptions"></select>

<!--
											<ui-select ng-model="address.attributes.type">
												<ui-select-match class="ab-multi-input-select" placeholder="Please select...">{{$select.selected.label}}</ui-select-match>
												<ui-select-choices repeat="item.value as item in emailAddressOptions | filter: $select.search">
													<div ng-bind-html="item.label | highlight: $select.search"></div>
												</ui-select-choices>
											</ui-select>-->

											<span class="input-group-btn">
												<button type="button" class="btn btn-danger" ng-click="address.attributes.markDeleted = true;"><i class="fa fa-trash-o"></i></button>
											</span>				
										</div>
									</div>

									<div class="form-group no-label">
										<textarea ng-model="address.attributes.street" autofocus="!address.attributes.id" style="height:70px" placeholder="{{'Street address'| t}}"></textarea>		
									</div>
									<div class="form-group no-label">
										<input type="text" ng-model="address.attributes.zipCode" placeholder="{{'Zip code'| t}}">
									</div>
									<div class="form-group no-label">
										<input type="text" ng-model="address.attributes.city" placeholder="{{'City'| t}}">
									</div>
									<div class="form-group no-label">
										<input type="text" ng-model="address.attributes.state" placeholder="{{'State / Province / Region'| t}}">
									</div>
									<div class="form-group no-label">
										<input type="text" ng-model="address.attributes.country" placeholder="{{'Country'| t}}" />
									</div>
								</div>
							</div>
						
							<span class="btn btn-default" ng-click="addAddress()"><i class="fa fa-plus"></i> {{"Add address"| t}}</span>
						

						</div>

					</div>
				
			<!--</div>-->
			<!--<div class="col-lg-6">-->
				<im-custom-fields-edit im-model="contact" im-server-model="Intermesh\Modules\Contacts\Model\ContactCustomFields"></im-custom-fields-edit>				
			<!--</div>-->
		<!--</div>-->
	</div>
</form>